// "tracksOn": '<svg _ngcontent-hdc-c20="" width="96" height="93" viewBox="0 0 96 93" fill="none" xmlns="http://www.w3.org/2000/svg" class="music"><path _ngcontent-hdc-c20="" d="M40 47C42.7614 47 45 49.2386 45 52C45 54.7614 42.7614 57 40 57C37.2386 57 35 54.7614 35 52C35 49.2386 37.2386 47 40 47Z" stroke="currentColor" stroke-width="2"></path><path _ngcontent-hdc-c20="" d="M55 47C57.7614 47 60 49.2386 60 52C60 54.7615 57.7614 57 55 57C52.2385 57 50 54.7615 50 52C50 49.2386 52.2385 47 55 47Z" stroke="currentColor" stroke-width="2"></path><rect _ngcontent-hdc-c20="" x="44" y="34" width="2" height="19" rx="1" fill="currentColor"></rect><rect _ngcontent-hdc-c20="" x="59" y="34" width="2" height="19" rx="1" fill="currentColor"></rect><rect _ngcontent-hdc-c20="" x="44" y="40" width="2" height="17" rx="1" transform="rotate(-90 44 40)" fill="currentColor"></rect><rect _ngcontent-hdc-c20="" x="44" y="36" width="2" height="17" rx="1" transform="rotate(-90 44 36)" fill="currentColor"></rect></svg>',
// "tracksOff": '<svg _ngcontent-hdc-c20="" width="96" height="93" viewBox="0 0 96 93" fill="none" xmlns="http://www.w3.org/2000/svg" class="mute"><path _ngcontent-hdc-c20="" d="M40 47C42.7614 47 45 49.2386 45 52C45 54.7614 42.7614 57 40 57C37.2386 57 35 54.7614 35 52C35 49.2386 37.2386 47 40 47Z" stroke="currentColor" stroke-width="2"></path><path _ngcontent-hdc-c20="" d="M55 47C57.7614 47 60 49.2386 60 52C60 54.7615 57.7614 57 55 57C52.2385 57 50 54.7615 50 52C50 49.2386 52.2385 47 55 47Z" stroke="currentColor" stroke-width="2"></path><rect _ngcontent-hdc-c20="" x="44" y="34" width="2" height="19" rx="1" fill="currentColor"></rect><rect _ngcontent-hdc-c20="" x="59" y="34" width="2" height="19" rx="1" fill="currentColor"></rect><rect _ngcontent-hdc-c20="" x="44" y="40" width="2" height="17" rx="1" transform="rotate(-90 44 40)" fill="currentColor"></rect><rect _ngcontent-hdc-c20="" x="44" y="36" width="2" height="17" rx="1" transform="rotate(-90 44 36)" fill="currentColor"></rect><path _ngcontent-hdc-c20="" fill-rule="evenodd" clip-rule="evenodd" d="M61.9998 58C61.6329 58.4128 61.0008 58.4499 60.588 58.083L35.0829 35.4117C34.6701 35.0448 34.6329 34.4128 34.9998 34V34C35.3667 33.5872 35.9988 33.55 36.4116 33.9169L61.9168 56.5882C62.3296 56.9551 62.3667 57.5872 61.9998 58V58Z" fill="currentColor"></path></svg>',
// "allTracksOn": '<svg _ngcontent-hdc-c25="" width="97" height="93" viewBox="0 0 97 93" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-hdc-c25="" d="M62 45.9999C59.2386 45.9999 57 43.7613 57 40.9999C57 38.2385 59.2386 35.9999 62 35.9999C64.7614 35.9999 67 38.2385 67 40.9999C67 43.7613 64.7614 45.9999 62 45.9999Z" stroke="currentColor" stroke-width="2"></path><path _ngcontent-hdc-c25="" d="M49 45.9999C46.2386 45.9999 44 43.7613 44 40.9999C44 38.2385 46.2386 35.9999 49 35.9999C51.7614 35.9999 54 38.2385 54 40.9999C54 43.7613 51.7614 45.9999 49 45.9999Z" stroke="currentColor" stroke-width="2"></path><path _ngcontent-hdc-c25="" d="M36 45.9999C33.2386 45.9999 31 43.7613 31 40.9999C31 38.2385 33.2386 35.9999 36 35.9999C38.7614 35.9999 41 38.2385 41 40.9999C41 43.7613 38.7614 45.9999 36 45.9999Z" stroke="currentColor" stroke-width="2"></path><path _ngcontent-hdc-c25="" d="M42 57.9999C39.2386 57.9999 37 55.7613 37 52.9999C37 50.2385 39.2386 47.9999 42 47.9999C44.7614 47.9999 47 50.2385 47 52.9999C47 55.7613 44.7614 57.9999 42 57.9999Z" stroke="currentColor" stroke-width="2"></path><path _ngcontent-hdc-c25="" d="M56 58C53.2386 58 51 55.7614 51 53C51 50.2386 53.2386 48 56 48C58.7614 48 61 50.2386 61 53C61 55.7614 58.7614 58 56 58Z" stroke="currentColor" stroke-width="2"></path></svg>',
// "cutOff": '<svg _ngcontent-hdc-c17="" width="97" height="93" viewBox="0 0 97 93" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-hdc-c17="" fill-rule="evenodd" clip-rule="evenodd" d="M22.3032 41.25C22.1024 41.9302 22 42.6375 22 43.35V45.5C22 46.0523 22.4477 46.5 23 46.5H23.0763C23.6288 46.5 24.0766 46.0519 24.0763 45.4994L24.0749 43.35C24.0749 42.6603 24.2093 41.9774 24.4704 41.3402C24.7315 40.703 25.1139 40.1241 25.5966 39.6364C26.0788 39.1487 26.6513 38.7619 27.2816 38.4979C27.9118 38.234 28.5872 38.0982 29.2692 38.0982C29.9512 38.0982 30.6266 38.234 31.2569 38.4979C31.8872 38.7619 32.4597 39.1487 32.9419 39.6364C33.4246 40.1241 33.8069 40.703 34.0681 41.3402C34.3292 41.9774 34.4636 42.6603 34.4636 43.35L34.4615 45.45V46.5V49.65C34.4615 50.3625 34.564 51.0698 34.7648 51.75C34.7937 51.8487 34.8246 51.9467 34.8581 52.0442C34.9062 52.1851 34.9585 52.3247 35.0147 52.4627C35.3803 53.3545 35.9158 54.1647 36.5907 54.8472C37.2656 55.5297 38.0673 56.0712 38.949 56.4405C39.8308 56.8099 40.776 57 41.7308 57C42.6856 57 43.6307 56.8099 44.5125 56.4405C45.3943 56.0711 46.196 55.5297 46.8708 54.8472C47.5457 54.1647 48.0812 53.3544 48.4468 52.4627C48.5421 52.2292 48.6258 51.9913 48.6968 51.75C48.8976 51.0698 49 50.3625 49 49.65V48V43.35C49 42.6603 49.2093 41.9774 49.4704 41.3402C49.7315 40.703 50.1139 40.1241 50.5966 39.6364C51.0788 39.1487 51.6513 38.7619 52.2816 38.4979C52.9118 38.234 53.5872 38.0982 54.2692 38.0982C54.9512 38.0982 55.6266 38.234 56.2569 38.4979C56.8872 38.7619 57.4597 39.1487 57.9419 39.6364C58.4246 40.1241 58.8069 40.703 59.0681 41.3402C59.3292 41.9774 59.4636 42.6603 59.4636 43.35L59.4615 45.45V46.5V49.65C59.4615 50.3625 59.564 51.0698 59.7648 51.75C59.7937 51.8487 59.8246 51.9467 59.8581 52.0442C59.9062 52.1851 59.9585 52.3247 60.0147 52.4627C60.3803 53.3545 60.9158 54.1647 61.5907 54.8472C62.2656 55.5297 63.0673 56.0712 63.949 56.4405C64.8308 56.8099 65.776 57 66.7308 57C67.6856 57 68.6307 56.8099 69.5125 56.4405C70.3943 56.0711 71.1959 55.5297 71.8708 54.8472C72.5457 54.1647 73.0812 53.3544 73.4468 52.4627C73.5421 52.2292 73.6258 51.9913 73.6968 51.75C73.8976 51.0698 74 50.3625 74 49.65L74.0471 48.029C74.0634 47.4656 73.6111 47 73.0475 47H72.9714C72.4304 47 71.9875 47.4302 71.9718 47.971L71.9231 49.65C71.9246 50.3409 71.7902 51.0232 71.5296 51.6598C71.2685 52.297 70.8861 52.8759 70.4034 53.3636C69.9212 53.8513 69.3487 54.2381 68.7185 54.5021C68.0882 54.766 67.4128 54.9018 66.7308 54.9018C66.0488 54.9018 65.3734 54.766 64.7431 54.5021C64.1128 54.2381 63.5403 53.8513 63.0581 53.3636C62.5754 52.8759 62.1931 52.297 61.9319 51.6598C61.6716 51.0244 61.5372 50.3435 61.5364 49.6557C61.5364 49.6544 61.5368 49.653 61.5374 49.6518C61.5381 49.6506 61.5385 49.6493 61.5385 49.6479V46.5V45.45V43.35C61.5385 42.6375 61.436 41.9302 61.2352 41.25C61.1642 41.0087 61.0806 40.7708 60.9853 40.5373C60.6197 39.6455 60.0842 38.8353 59.4093 38.1528C58.7344 37.4702 57.9327 36.9288 57.051 36.5595C56.1692 36.1901 55.224 36 54.2692 36C53.3144 36 52.3693 36.1901 51.4875 36.5595C50.6057 36.9288 49.804 37.4702 49.1292 38.1528C48.4543 38.8353 47.9188 39.6455 47.5532 40.5373C47.4579 40.7708 47.3742 41.0087 47.3032 41.25C47.1024 41.9302 47 42.6375 47 43.35V48V49.65C47.0015 50.3409 46.7902 51.0232 46.5296 51.6598C46.2685 52.297 45.8861 52.8759 45.4034 53.3636C44.9212 53.8513 44.3487 54.2381 43.7185 54.5021C43.0882 54.766 42.4128 54.9018 41.7308 54.9018C41.0488 54.9018 40.3734 54.766 39.7431 54.5021C39.1128 54.2381 38.5403 53.8513 38.0581 53.3636C37.5754 52.8759 37.1931 52.297 36.9319 51.6598C36.6716 51.0244 36.5372 50.3435 36.5364 49.6557C36.5364 49.6544 36.5368 49.653 36.5374 49.6518C36.5381 49.6506 36.5385 49.6493 36.5385 49.6479V46.5V45.45V43.35C36.5385 42.6375 36.436 41.9302 36.2352 41.25C36.1643 41.0087 36.0806 40.7708 35.9853 40.5373C35.6197 39.6455 35.0842 38.8353 34.4093 38.1528C33.7344 37.4702 32.9327 36.9288 32.051 36.5595C31.1692 36.1901 30.224 36 29.2692 36C28.3144 36 27.3693 36.1901 26.4875 36.5595C25.6057 36.9288 24.804 37.4702 24.1292 38.1528C23.4543 38.8353 22.9188 39.6455 22.5532 40.5373C22.4579 40.7708 22.3742 41.0087 22.3032 41.25Z" fill="currentColor"></path></svg>',
// "trackLengrh": '<svg _ngcontent-hdc-c16="" width="97" height="93" viewBox="0 0 97 93" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-hdc-c16="" d="M62 45.9999C59.2386 45.9999 57 43.7613 57 40.9999C57 38.2385 59.2386 35.9999 62 35.9999C64.7614 35.9999 67 38.2385 67 40.9999C67 43.7613 64.7614 45.9999 62 45.9999Z" fill="currentColor"></path><path _ngcontent-hdc-c16="" d="M49 45.9999C46.2386 45.9999 44 43.7613 44 40.9999C44 38.2385 46.2386 35.9999 49 35.9999C51.7614 35.9999 54 38.2385 54 40.9999C54 43.7613 51.7614 45.9999 49 45.9999Z" fill="currentColor"></path><path _ngcontent-hdc-c16="" d="M36 45.9999C33.2386 45.9999 31 43.7613 31 40.9999C31 38.2385 33.2386 35.9999 36 35.9999C38.7614 35.9999 41 38.2385 41 40.9999C41 43.7613 38.7614 45.9999 36 45.9999Z" fill="currentColor"></path><path _ngcontent-hdc-c16="" d="M62 58C59.2386 58 57 55.7614 57 53C57 50.2386 59.2386 48 62 48C64.7614 48 67 50.2386 67 53C67 55.7614 64.7614 58 62 58Z" fill="#DBE4E9" class="off"></path><path _ngcontent-hdc-c16="" d="M49 58C46.2386 58 44 55.7614 44 53C44 50.2386 46.2386 48 49 48C51.7614 48 54 50.2386 54 53C54 55.7614 51.7614 58 49 58Z" fill="#DBE4E9" class="off"></path><path _ngcontent-hdc-c16="" d="M36 58C33.2386 58 31 55.7614 31 53C31 50.2386 33.2386 48 36 48C38.7614 48 41 50.2386 41 53C41 55.7614 38.7614 58 36 58Z" fill="currentColor"></path></svg>',
// "play": '<svg _ngcontent-hdc-c22="" width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="ng-star-inserted" style=""><path _ngcontent-hdc-c22="" d="M0.36122 1.98205C0.36122 1.21225 1.19455 0.731123 1.86122 1.11602L11.6112 6.74519C12.2779 7.13009 12.2779 8.09234 11.6112 8.47724L1.86122 14.1064C1.19455 14.4913 0.36122 14.0102 0.36122 13.2404L0.36122 1.98205Z" fill="currentColor"></path></svg>',
// "tap": '<svg _ngcontent-hdc-c23="" width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-hdc-c23="" fill-rule="evenodd" clip-rule="evenodd" d="M16.8383 17.385C17.0844 16.5274 17.8686 15.9365 18.7608 15.9365H23.9206C24.8127 15.9365 25.597 16.5274 25.843 17.385L26.5459 19.8348L31.88 16.1162L33.0237 17.7569L27.1287 21.8665L28.6026 27.0041C28.9693 28.2822 28.0098 29.5556 26.6802 29.5556H16.0012C14.6716 29.5556 13.7121 28.2822 14.0788 27.0041L16.8383 17.385ZM24.812 21.0436L21.5891 23.2904C21.1361 23.6062 21.0248 24.2295 21.3407 24.6826V24.6826C21.6565 25.1356 22.2799 25.2469 22.7329 24.931L25.3948 23.0753L26.6802 27.5556L16.0012 27.5556L18.7608 17.9365H23.9206L24.812 21.0436Z" fill="currentColor"></path><circle _ngcontent-hdc-c23="" cx="31.0073" cy="18" r="3" fill="#1F73F3"></circle></svg>',
// "metronome": '<svg _ngcontent-hdc-c24="" width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-hdc-c24="" d="M21.4444 23.2222C21.4444 25.5541 19.5541 27.4444 17.2222 27.4444C14.8904 27.4444 13 25.5541 13 23.2222C13 20.8904 14.8904 19 17.2222 19C19.5541 19 21.4444 20.8904 21.4444 23.2222Z" fill="currentColor"></path><path _ngcontent-hdc-c24="" fill-rule="evenodd" clip-rule="evenodd" d="M17.2222 26.3889C18.9711 26.3889 20.3889 24.9711 20.3889 23.2222C20.3889 21.4733 18.9711 20.0556 17.2222 20.0556C15.4733 20.0556 14.0556 21.4733 14.0556 23.2222C14.0556 24.9711 15.4733 26.3889 17.2222 26.3889ZM17.2222 27.4444C19.5541 27.4444 21.4444 25.5541 21.4444 23.2222C21.4444 20.8904 19.5541 19 17.2222 19C14.8904 19 13 20.8904 13 23.2222C13 25.5541 14.8904 27.4444 17.2222 27.4444Z" fill="currentColor"></path><path _ngcontent-hdc-c24="" d="M32.0001 23.2222C32.0001 25.5541 30.1098 27.4444 27.7779 27.4444C25.446 27.4444 23.5557 25.5541 23.5557 23.2222C23.5557 20.8904 25.446 19 27.7779 19C30.1098 19 32.0001 20.8904 32.0001 23.2222Z" fill="currentColor"></path></svg>',
// "clear": '<svg _ngcontent-hdc-c31="" width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg"><path _ngcontent-hdc-c31="" d="M15.0093 17.7815C15.3879 17.2888 15.9739 17 16.5953 17H30C31.1046 17 32 17.8954 32 19V27C32 28.1046 31.1046 29 30 29H16.5953C15.9739 29 15.3879 28.7112 15.0093 28.2185L11.9362 24.2185C11.3841 23.5 11.3841 22.5 11.9362 21.7815L15.0093 17.7815Z" stroke="currentColor" stroke-width="2"></path><circle _ngcontent-hdc-c31="" cx="22" cy="23" r="3" fill="currentColor"></circle></svg>',


const svgElemnts = {
    "1": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M25.6313 20.2968C25.6313 20.8491 26.079 21.2968 26.6312 21.2968H26.6906C27.2429 21.2968 27.6906 20.8491 27.6906 20.2968V17.9322L29.7381 19.1143C30.2164 19.3904 30.828 19.2266 31.1041 18.7483L31.1338 18.6969C31.41 18.2186 31.2461 17.607 30.7678 17.3308L28.7196 16.1483L30.7682 14.9655C31.2465 14.6893 31.4104 14.0777 31.1343 13.5995L31.1046 13.5481C30.8284 13.0698 30.2168 12.9059 29.7386 13.182L27.6906 14.3644V12C27.6906 11.4477 27.2429 11 26.6906 11H26.6313C26.079 11 25.6313 11.4477 25.6313 12L25.6313 14.3653L23.5826 13.1825C23.1043 12.9063 22.4927 13.0702 22.2166 13.5485L22.1869 13.5999C21.9107 14.0782 22.0746 14.6898 22.5529 14.9659L24.6008 16.1483L22.5533 17.3304C22.075 17.6066 21.9112 18.2181 22.1873 18.6964L22.217 18.7478C22.4931 19.2261 23.1047 19.39 23.583 19.1139L25.6313 17.9313L25.6313 20.2968Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M25.6313 20.2968C25.6313 20.8491 26.079 21.2968 26.6312 21.2968H26.6906C27.2429 21.2968 27.6906 20.8491 27.6906 20.2968V17.9322L29.7381 19.1143C30.2164 19.3904 30.828 19.2266 31.1041 18.7483L31.1338 18.6969C31.41 18.2186 31.2461 17.607 30.7678 17.3308L28.7196 16.1483L30.7682 14.9655C31.2465 14.6893 31.4104 14.0777 31.1343 13.5995L31.1046 13.5481C30.8284 13.0698 30.2168 12.9059 29.7386 13.182L27.6906 14.3644V12C27.6906 11.4477 27.2429 11 26.6906 11H26.6313C26.079 11 25.6313 11.4477 25.6313 12L25.6313 14.3653L23.5826 13.1825C23.1043 12.9063 22.4927 13.0702 22.2166 13.5485L22.1869 13.5999C21.9107 14.0782 22.0746 14.6898 22.5529 14.9659L24.6008 16.1483L22.5533 17.3304C22.075 17.6066 21.9112 18.2181 22.1873 18.6964L22.217 18.7478C22.4931 19.2261 23.1047 19.39 23.583 19.1139L25.6313 17.9313L25.6313 20.2968Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M25.6313 20.2968C25.6313 20.8491 26.079 21.2968 26.6312 21.2968H26.6906C27.2429 21.2968 27.6906 20.8491 27.6906 20.2968V17.9322L29.7381 19.1143C30.2164 19.3904 30.828 19.2266 31.1041 18.7483L31.1338 18.6969C31.41 18.2186 31.2461 17.607 30.7678 17.3308L28.7196 16.1483L30.7682 14.9655C31.2465 14.6893 31.4104 14.0777 31.1343 13.5995L31.1046 13.5481C30.8284 13.0698 30.2168 12.9059 29.7386 13.182L27.6906 14.3644V12C27.6906 11.4477 27.2429 11 26.6906 11H26.6313C26.079 11 25.6313 11.4477 25.6313 12L25.6313 14.3653L23.5826 13.1825C23.1043 12.9063 22.4927 13.0702 22.2166 13.5485L22.1869 13.5999C21.9107 14.0782 22.0746 14.6898 22.5529 14.9659L24.6008 16.1483L22.5533 17.3304C22.075 17.6066 21.9112 18.2181 22.1873 18.6964L22.217 18.7478C22.4931 19.2261 23.1047 19.39 23.583 19.1139L25.6313 17.9313L25.6313 20.2968Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M14.5781 26.8353C14.5781 27.404 15.0391 27.865 15.6078 27.865C16.1764 27.865 16.6374 27.404 16.6374 26.8353V24.5007L18.6854 25.6831C19.1637 25.9592 19.7753 25.7953 20.0514 25.317L20.0811 25.2656C20.3572 24.7873 20.1934 24.1757 19.7151 23.8996L17.6668 22.717L19.7151 21.5344C20.1934 21.2583 20.3572 20.6467 20.0811 20.1684L20.0514 20.117C19.7753 19.6387 19.1637 19.4748 18.6854 19.751L16.6374 20.9334V18.5979C16.6374 18.0292 16.1764 17.5682 15.6078 17.5682C15.0391 17.5682 14.5781 18.0292 14.5781 18.5979L14.5781 20.9338L12.5299 19.7512C12.0516 19.4751 11.44 19.639 11.1638 20.1172L11.1342 20.1686C10.858 20.6469 11.0219 21.2585 11.5002 21.5347L13.5481 22.717L11.5002 23.8994C11.0219 24.1755 10.858 24.7871 11.1341 25.2654L11.1638 25.3168C11.44 25.7951 12.0516 25.959 12.5298 25.6828L14.5781 24.5003L14.5781 26.8353Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M14.5781 26.8353C14.5781 27.404 15.0391 27.865 15.6078 27.865C16.1764 27.865 16.6374 27.404 16.6374 26.8353V24.5007L18.6854 25.6831C19.1637 25.9592 19.7753 25.7953 20.0514 25.317L20.0811 25.2656C20.3572 24.7873 20.1934 24.1757 19.7151 23.8996L17.6668 22.717L19.7151 21.5344C20.1934 21.2583 20.3572 20.6467 20.0811 20.1684L20.0514 20.117C19.7753 19.6387 19.1637 19.4748 18.6854 19.751L16.6374 20.9334V18.5979C16.6374 18.0292 16.1764 17.5682 15.6078 17.5682C15.0391 17.5682 14.5781 18.0292 14.5781 18.5979L14.5781 20.9338L12.5299 19.7512C12.0516 19.4751 11.44 19.639 11.1638 20.1172L11.1342 20.1686C10.858 20.6469 11.0219 21.2585 11.5002 21.5347L13.5481 22.717L11.5002 23.8994C11.0219 24.1755 10.858 24.7871 11.1341 25.2654L11.1638 25.3168C11.44 25.7951 12.0516 25.959 12.5298 25.6828L14.5781 24.5003L14.5781 26.8353Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M14.5781 26.8353C14.5781 27.404 15.0391 27.865 15.6078 27.865C16.1764 27.865 16.6374 27.404 16.6374 26.8353V24.5007L18.6854 25.6831C19.1637 25.9592 19.7753 25.7953 20.0514 25.317L20.0811 25.2656C20.3572 24.7873 20.1934 24.1757 19.7151 23.8996L17.6668 22.717L19.7151 21.5344C20.1934 21.2583 20.3572 20.6467 20.0811 20.1684L20.0514 20.117C19.7753 19.6387 19.1637 19.4748 18.6854 19.751L16.6374 20.9334V18.5979C16.6374 18.0292 16.1764 17.5682 15.6078 17.5682C15.0391 17.5682 14.5781 18.0292 14.5781 18.5979L14.5781 20.9338L12.5299 19.7512C12.0516 19.4751 11.44 19.639 11.1638 20.1172L11.1342 20.1686C10.858 20.6469 11.0219 21.2585 11.5002 21.5347L13.5481 22.717L11.5002 23.8994C11.0219 24.1755 10.858 24.7871 11.1341 25.2654L11.1638 25.3168C11.44 25.7951 12.0516 25.959 12.5298 25.6828L14.5781 24.5003L14.5781 26.8353Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M25.6304 33.0431C25.6304 33.5954 26.0781 34.0431 26.6304 34.0431H26.6897C27.242 34.0431 27.6897 33.5954 27.6897 33.0431V30.6782L29.7381 31.8608C30.2164 32.1369 30.828 31.9731 31.1042 31.4948L31.1338 31.4434C31.41 30.9651 31.2461 30.3535 30.7678 30.0773L28.7197 28.8948L30.7678 27.7123C31.2461 27.4362 31.41 26.8246 31.1338 26.3463L31.1041 26.2949C30.828 25.8166 30.2164 25.6528 29.7381 25.9289L27.6897 27.1115V24.7463C27.6897 24.1941 27.242 23.7463 26.6897 23.7463H26.6304C26.0781 23.7463 25.6304 24.1941 25.6304 24.7463L25.6304 27.1112L23.5826 25.929C23.1043 25.6528 22.4927 25.8167 22.2166 26.295L22.1869 26.3464C21.9107 26.8247 22.0746 27.4363 22.5529 27.7124L24.6009 28.8948L22.5529 30.0773C22.0746 30.3534 21.9107 30.965 22.1869 31.4433L22.2166 31.4947C22.4927 31.973 23.1043 32.1369 23.5826 31.8607L25.6304 30.6784L25.6304 33.0431Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M25.6304 33.0431C25.6304 33.5954 26.0781 34.0431 26.6304 34.0431H26.6897C27.242 34.0431 27.6897 33.5954 27.6897 33.0431V30.6782L29.7381 31.8608C30.2164 32.1369 30.828 31.9731 31.1042 31.4948L31.1338 31.4434C31.41 30.9651 31.2461 30.3535 30.7678 30.0773L28.7197 28.8948L30.7678 27.7123C31.2461 27.4362 31.41 26.8246 31.1338 26.3463L31.1041 26.2949C30.828 25.8166 30.2164 25.6528 29.7381 25.9289L27.6897 27.1115V24.7463C27.6897 24.1941 27.242 23.7463 26.6897 23.7463H26.6304C26.0781 23.7463 25.6304 24.1941 25.6304 24.7463L25.6304 27.1112L23.5826 25.929C23.1043 25.6528 22.4927 25.8167 22.2166 26.295L22.1869 26.3464C21.9107 26.8247 22.0746 27.4363 22.5529 27.7124L24.6009 28.8948L22.5529 30.0773C22.0746 30.3534 21.9107 30.965 22.1869 31.4433L22.2166 31.4947C22.4927 31.973 23.1043 32.1369 23.5826 31.8607L25.6304 30.6784L25.6304 33.0431Z" fill="currentColor"></path><path _ngcontent-yki-c7="" fill-rule="evenodd" clip-rule="evenodd" d="M25.6304 33.0431C25.6304 33.5954 26.0781 34.0431 26.6304 34.0431H26.6897C27.242 34.0431 27.6897 33.5954 27.6897 33.0431V30.6782L29.7381 31.8608C30.2164 32.1369 30.828 31.9731 31.1042 31.4948L31.1338 31.4434C31.41 30.9651 31.2461 30.3535 30.7678 30.0773L28.7197 28.8948L30.7678 27.7123C31.2461 27.4362 31.41 26.8246 31.1338 26.3463L31.1041 26.2949C30.828 25.8166 30.2164 25.6528 29.7381 25.9289L27.6897 27.1115V24.7463C27.6897 24.1941 27.242 23.7463 26.6897 23.7463H26.6304C26.0781 23.7463 25.6304 24.1941 25.6304 24.7463L25.6304 27.1112L23.5826 25.929C23.1043 25.6528 22.4927 25.8167 22.2166 26.295L22.1869 26.3464C21.9107 26.8247 22.0746 27.4363 22.5529 27.7124L24.6009 28.8948L22.5529 30.0773C22.0746 30.3534 21.9107 30.965 22.1869 31.4433L22.2166 31.4947C22.4927 31.973 23.1043 32.1369 23.5826 31.8607L25.6304 30.6784L25.6304 33.0431Z" fill="currentColor"></path></svg>',
    "2": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M21.5292 10.9615C21.5292 10.4305 21.9597 10 22.4907 10V10C23.0218 10 23.4523 10.4305 23.4523 10.9615V14.8727C23.4523 15.3819 22.9999 15.7693 22.4907 15.7693V15.7693V15.7693C21.9816 15.7693 21.5292 15.3819 21.5292 14.8727V10.9615ZM22.4907 29.2309V29.2309C22.9999 29.2309 23.4523 29.6183 23.4523 30.1275V34.0385C23.4523 34.5695 23.0218 35 22.4907 35V35C21.9597 35 21.5292 34.5695 21.5292 34.0385V30.1275C21.5292 29.6183 21.9816 29.2309 22.4907 29.2309V29.2309ZM29.0932 32.0116C29.3587 32.4715 29.2011 33.0596 28.7412 33.3251V33.3251C28.2813 33.5906 27.6933 33.433 27.4277 32.9731L25.4725 29.5865C25.2181 29.1459 25.4197 28.5832 25.8599 28.3282V28.3282C26.3005 28.073 26.8831 28.1836 27.1376 28.6245L29.0932 32.0116ZM19.51 15.4131C19.7644 15.8537 19.5627 16.4165 19.1224 16.6715V16.6715C18.6819 16.9266 18.0994 16.816 17.8448 16.3751L15.8893 12.9879C15.6238 12.528 15.7813 11.94 16.2412 11.6745V11.6745C16.7011 11.4089 17.2892 11.5665 17.5547 12.0264L19.51 15.4131ZM32.002 29.1072C32.4619 29.3727 33.05 29.2151 33.3155 28.7552V28.7552C33.581 28.2953 33.4235 27.7073 32.9636 27.4417L29.5749 25.4853C29.1345 25.231 28.5721 25.4323 28.3169 25.8722V25.8722C28.0613 26.3128 28.1718 26.8958 28.6129 27.1505L32.002 29.1072ZM15.4015 19.5228C15.8423 19.7773 16.4053 19.5754 16.6602 19.1347V19.1347C16.915 18.6942 16.8042 18.1121 16.3635 17.8577L12.9784 15.9033C12.5185 15.6377 11.9304 15.7953 11.6649 16.2552V16.2552C11.3994 16.7151 11.5569 17.3032 12.0168 17.5687L15.4015 19.5228ZM29.2304 22.5848V22.5848C29.2304 23.0967 29.6198 23.5516 30.1316 23.5516H34.0385C34.5695 23.5516 35 23.1212 35 22.5901V22.5901C35 22.0591 34.5695 21.6286 34.0385 21.6286H30.1224C29.6159 21.6286 29.2304 22.0783 29.2304 22.5848V22.5848ZM10 22.5901C10 23.1212 10.4305 23.5516 10.9615 23.5516H14.8677C15.3795 23.5516 15.7689 23.0967 15.7689 22.5848V22.5848V22.5848C15.7689 22.0783 15.3833 21.6286 14.8769 21.6286H10.9615C10.4305 21.6286 10 22.0591 10 22.5901V22.5901ZM32.9638 17.5688C33.4237 17.3033 33.5813 16.7152 33.3158 16.2553V16.2553C33.0502 15.7954 32.4622 15.6378 32.0023 15.9034L28.6177 17.8574C28.177 18.1119 28.0662 18.6941 28.3211 19.1346V19.1346C28.5759 19.5752 29.1389 19.7771 29.5797 19.5226L32.9638 17.5688ZM16.3683 27.1502C16.8094 26.8956 16.9199 26.3126 16.6643 25.872V25.872C16.4092 25.4321 15.8467 25.2308 15.4063 25.4851L12.0171 27.4418C11.5572 27.7073 11.3996 28.2954 11.6651 28.7553V28.7553C11.9306 29.2152 12.5187 29.3728 12.9786 29.1073L16.3683 27.1502ZM27.4889 12.0552C27.7571 11.5968 28.3461 11.4427 28.8044 11.7109V11.7109C29.2628 11.9791 29.4169 12.568 29.1487 13.0264L27.1732 16.4026C26.9161 16.842 26.3328 16.9492 25.8937 16.6914V16.6914C25.455 16.4338 25.2567 15.87 25.5137 15.4309L27.4889 12.0552ZM17.8093 28.5977C18.0664 28.1582 18.6497 28.0511 19.0887 28.3088V28.3088C19.5275 28.5663 19.7258 29.1302 19.4689 29.5693L17.4942 32.9441C17.226 33.4025 16.637 33.5566 16.1787 33.2884V33.2884C15.7203 33.0202 15.5662 32.4312 15.8344 31.9729L17.8093 28.5977Z" fill="currentColor"></path></svg>',
    "3": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M22.5161 35.9677C29.9631 35.9677 36 29.9308 36 22.4839C36 15.0369 29.9631 9 22.5161 9C15.6653 9 10.0078 14.1091 9.14595 20.7249C9.73581 21.0883 10.129 21.7402 10.129 22.4839C10.129 23.2276 9.73581 23.8794 9.14595 24.2428C10.0078 30.8587 15.6653 35.9677 22.5161 35.9677ZM7.14129 24.331C8.0543 32.0117 14.5897 37.9677 22.5161 37.9677C31.0676 37.9677 38 31.0354 38 22.4839C38 13.9324 31.0676 7 22.5161 7C14.5897 7 8.05429 12.956 7.14129 20.6368C6.46457 20.9757 6 21.6755 6 22.4839C6 23.2922 6.46457 23.9921 7.14129 24.331ZM26.6452 22.4839C26.6452 24.7643 24.7965 26.6129 22.5161 26.6129C20.2357 26.6129 18.3871 24.7643 18.3871 22.4839C18.3871 20.2035 20.2357 18.3548 22.5161 18.3548C24.7965 18.3548 26.6452 20.2035 26.6452 22.4839Z" fill="currentColor"></path></svg>',
    "4": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M25.9873 23.9333C25.8971 27.2269 25.3349 30.1131 24.5276 32.1682C24.0838 33.2978 23.605 34.0763 23.1754 34.5387C22.7484 34.9985 22.5185 35 22.5 35C22.4815 35 22.2516 34.9985 21.8246 34.5387C21.395 34.0763 20.9162 33.2978 20.4724 32.1682C19.6651 30.1131 19.1029 27.2269 19.0127 23.9333L25.9873 23.9333ZM27.988 23.9333H36.0667C36.5821 23.9333 37 23.5155 37 23C37 22.4845 36.5821 22.0667 36.0667 22.0667H27.988C27.7993 14.7698 25.4144 9 22.5 9C19.5856 9 17.2007 14.7698 17.012 22.0667H8.93333C8.41787 22.0667 8 22.4845 8 23C8 23.5155 8.41787 23.9333 8.93333 23.9333H17.012C17.2007 31.2302 19.5856 37 22.5 37C25.4144 37 27.7993 31.2302 27.988 23.9333ZM19.0127 22.0667C19.1029 18.7731 19.6651 15.8869 20.4724 13.8318C20.9162 12.7022 21.395 11.9237 21.8246 11.4613C22.2516 11.0015 22.4815 11 22.5 11C22.5185 11 22.7484 11.0015 23.1754 11.4613C23.605 11.9237 24.0838 12.7022 24.5276 13.8318C25.3349 15.8869 25.8971 18.7731 25.9873 22.0667L19.0127 22.0667Z" fill="currentColor"></path></svg>',
    "5": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><circle  cx="22.5" cy="22.5" r="4.5" fill="currentColor"></circle></svg>',
    "6": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M32.0157 23.5624C31.3887 28.0748 27.5151 31.5486 22.8301 31.5486C19.9946 31.5486 17.4563 30.2761 15.7551 28.271C18.1698 27.9493 20.7915 27.4055 23.4262 26.6738C26.51 25.8173 29.4726 24.7421 32.0157 23.5624ZM32.0565 21.3256C29.4529 22.6132 26.2603 23.811 22.891 24.7467C19.9664 25.559 17.0828 26.1254 14.5248 26.4061C13.9046 25.162 13.5558 23.7589 13.5558 22.2743C13.5558 17.1522 17.7081 13 22.8301 13C27.6319 13 31.5814 16.6492 32.0565 21.3256ZM34.1018 22.5198C33.9712 28.633 28.9747 33.5486 22.8301 33.5486C18.9117 33.5486 15.4601 31.5496 13.4396 28.5157C13.19 28.5347 12.9437 28.5508 12.701 28.564C11.1203 28.6499 9.73538 28.6105 8.59186 28.4519C7.44853 28.2934 6.54638 28.0158 5.93146 27.6253C5.64508 27.4435 5.40182 27.2281 5.23345 26.9598C5.05147 26.6699 5.0024 26.3908 5.00009 26.1713C4.99409 25.6009 5.29165 24.9507 5.8959 24.2431C6.98912 22.9628 9.02808 21.5625 11.7424 20.2208C12.7078 14.9747 17.3048 11 22.8301 11C26.2002 11 29.2249 12.4786 31.2909 14.8226C34.175 14.6076 36.4992 14.7841 37.9666 15.3363C38.7938 15.6476 39.3225 16.0684 39.5504 16.5759C39.7757 17.0779 39.711 17.6748 39.3205 18.3524C38.9355 19.0205 38.2497 19.7392 37.3014 20.4786C36.4414 21.1491 35.3655 21.8369 34.1018 22.5198ZM32.6604 16.7497C34.7997 16.6755 36.3581 16.8679 37.2622 17.2081C37.4036 17.2613 37.5098 17.3111 37.5879 17.3533L37.5877 17.3538C37.385 17.7054 36.923 18.2375 36.0716 18.9014C35.4917 19.3535 34.778 19.8307 33.9358 20.3206C33.7127 19.0435 33.2747 17.8404 32.6604 16.7497ZM11.5595 22.5653C9.52768 23.6606 8.13388 24.7021 7.41686 25.5418C7.25635 25.7298 7.15486 25.8787 7.09168 25.9885C7.39027 26.1506 7.9514 26.344 8.86655 26.4709C9.80713 26.6013 10.9946 26.6445 12.4058 26.5765C11.893 25.3355 11.5954 23.9829 11.5595 22.5653Z" fill="currentColor"></path></svg>',
    "7": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M8.92452 21.1301L8.93315 21.0675C9.09219 19.9155 9.32653 18.7743 9.63601 17.6442L9.6527 17.5832L9.67719 17.5248C10.1345 16.4339 10.6631 15.3722 11.2625 14.3397L11.2944 14.2848L11.3332 14.2342C12.0676 13.2765 12.8643 12.3649 13.723 11.4993L13.7681 11.4539L13.8187 11.4143C14.7905 10.6552 15.8113 9.95636 16.881 9.31797L16.9364 9.28492L16.9957 9.25888C18.1485 8.75251 19.3338 8.31731 20.5513 7.95329L20.6135 7.93469L20.6777 7.92381C21.6179 7.76448 22.5654 7.64809 23.5201 7.57463C24.0678 7.53248 24.5343 7.95685 24.5635 8.50541C24.5931 9.05986 24.1651 9.53088 23.6116 9.575C22.7702 9.64208 21.9353 9.74488 21.1068 9.88338C20.0144 10.2127 18.9508 10.6032 17.9157 11.0551C16.958 11.6296 16.0433 12.2557 15.1715 12.9336C14.4047 13.7102 13.692 14.5258 13.0332 15.3805C12.4997 16.3045 12.0277 17.2528 11.617 18.2256C11.3434 19.2346 11.1345 20.2522 10.9902 21.2784C10.9857 22.3066 11.0449 23.3274 11.1679 24.3412C11.4245 25.3234 11.7399 26.2834 12.1141 27.2214C12.6076 28.0974 13.1513 28.9382 13.7454 29.7441C14.4372 30.4622 15.1678 31.1348 15.9374 31.7622C16.7777 32.2825 17.6433 32.7502 18.5344 33.1654C19.4655 33.4617 20.4072 33.7018 21.3599 33.8859C22.3203 33.9471 23.2765 33.9522 24.2287 33.9014C25.1571 33.7314 26.0672 33.5092 26.9593 33.2347C27.7983 32.8524 28.6066 32.4247 29.3846 31.9516C30.0847 31.3884 30.7441 30.7894 31.3632 30.1544C31.8852 29.4522 32.3595 28.7256 32.7864 27.9745C33.104 27.1826 33.3702 26.3789 33.5852 25.5632C33.6859 24.7347 33.735 23.9073 33.7324 23.0807C33.6182 22.2693 33.4552 21.4711 33.2436 20.6861C32.9299 19.9421 32.5734 19.2224 32.1741 18.5268C31.6885 17.8945 31.1685 17.2955 30.6142 16.7295C29.9941 16.2444 29.3501 15.799 28.6819 15.3931C27.9721 15.0797 27.2497 14.8097 26.5145 14.5829C25.7634 14.4539 25.0115 14.369 24.2585 14.328C23.5155 14.3837 22.7828 14.4813 22.0603 14.6208C21.3718 14.8496 20.7039 15.1156 20.0562 15.4187C19.4634 15.7985 18.8995 16.2085 18.3642 16.6489C17.9004 17.1487 17.4715 17.6702 17.0772 18.2136C16.7657 18.7962 16.4927 19.391 16.2578 19.9982C16.1112 20.6227 16.0038 21.2495 15.9356 21.8789C15.955 22.5036 16.0121 23.1212 16.1065 23.7318C16.2826 24.317 16.4921 24.8865 16.7351 25.4404C17.0484 25.9509 17.3893 26.4386 17.7576 26.9037C18.1811 27.3108 18.6246 27.6899 19.0882 28.0413C19.5889 28.3247 20.1012 28.577 20.6252 28.7984C21.1669 28.9469 21.7114 29.0633 22.2591 29.1479C22.8046 29.1596 23.3448 29.1405 23.8796 29.0909C24.3939 28.9731 24.8952 28.8278 25.3838 28.6551C25.8357 28.4231 26.2683 28.1686 26.6822 27.8914C27.0463 27.5674 27.3869 27.2268 27.7041 26.8697C27.9493 26.5006 28.1709 26.1227 28.3692 25.7359C28.3908 25.6937 28.4092 25.65 28.424 25.605C28.5494 25.2254 28.6534 24.8436 28.7361 24.4593C28.7462 24.4125 28.7526 24.3651 28.7552 24.3173C28.7764 23.9354 28.7773 23.5565 28.7581 23.1804C28.7556 23.1326 28.7494 23.085 28.7395 23.0381C28.6634 22.6786 28.5695 22.3267 28.4578 21.9822C28.4431 21.9369 28.4248 21.8928 28.4032 21.8503C28.2319 21.5133 28.0441 21.1892 27.8397 20.8776C27.5825 20.5854 27.3118 20.3111 27.0275 20.0546C26.7161 19.844 26.3968 19.6533 26.0696 19.4822C25.7292 19.3605 25.3866 19.259 25.0418 19.1774C25.0096 19.1744 24.9773 19.1715 24.9451 19.1688C24.3971 19.1228 23.9389 18.6944 23.9225 18.1447C23.906 17.5903 24.3446 17.1238 24.8981 17.1598C25.0365 17.1688 25.1752 17.1804 25.314 17.1944L25.3801 17.2011L25.4449 17.2159C25.9204 17.3249 26.39 17.4642 26.8537 17.6334L26.9159 17.6561L26.9746 17.6863C27.421 17.916 27.8532 18.1743 28.2713 18.4609L28.3255 18.4981L28.3744 18.5416C28.7586 18.8839 29.121 19.251 29.4615 19.6428L29.5042 19.6919L29.5401 19.7459C29.8316 20.1842 30.0946 20.6418 30.329 21.1182L30.3575 21.1761L30.3782 21.237C30.5511 21.7471 30.6904 22.2691 30.7962 22.8027L30.8086 22.8655L30.8127 22.9294C30.8481 23.4806 30.8467 24.0351 30.8089 24.5926L30.8046 24.6563L30.7919 24.7189C30.6793 25.276 30.5292 25.827 30.342 26.3718L30.3212 26.4323L30.2926 26.4897C30.0312 27.015 29.7342 27.5249 29.4019 28.0192L29.3661 28.0725L29.3235 28.121C28.9227 28.5771 28.4908 29.009 28.028 29.4166L27.9794 29.4594L27.9256 29.4958C27.4051 29.8482 26.8602 30.1687 26.2912 30.4574L26.233 30.4869L26.1714 30.509C25.56 30.7284 24.9329 30.9102 24.2904 31.0542L24.2264 31.0686L24.161 31.075C23.4951 31.1399 22.8237 31.1635 22.1471 31.146L22.0814 31.1443L22.0165 31.1345C21.338 31.0328 20.6651 30.8889 19.9981 30.7029L19.9349 30.6853L19.8745 30.6601C19.2282 30.3904 18.5987 30.0803 17.9863 29.7302L17.9297 29.6978L17.8777 29.6588C17.3082 29.2311 16.7662 28.7677 16.2518 28.2689L16.2053 28.2239L16.1651 28.1735C15.714 27.6089 15.2996 27.0159 14.9219 26.3948L14.8886 26.34L14.8627 26.2815C14.5652 25.6113 14.3117 24.9221 14.1021 24.2144L14.084 24.1533L14.074 24.0905C13.9569 23.3543 13.8883 22.6104 13.868 21.8591L13.8663 21.7957L13.8728 21.7326C13.9517 20.9763 14.0805 20.2245 14.2591 19.4774L14.2739 19.4157L14.2966 19.3563C14.5745 18.629 14.9007 17.9186 15.2749 17.2253L15.3051 17.1692L15.3425 17.1173C15.8096 16.4683 16.3199 15.8478 16.8731 15.2562L16.9169 15.2093L16.9665 15.1681C17.5997 14.6433 18.2681 14.1574 18.9712 13.7105L19.0258 13.6758L19.0845 13.648C19.8489 13.2869 20.6376 12.9728 21.4504 12.7058L21.5123 12.6855L21.5764 12.6729C22.4269 12.5057 23.2891 12.3909 24.1625 12.3284L24.2277 12.3237L24.293 12.327C25.1773 12.3722 26.0591 12.4718 26.9383 12.6258L27.0027 12.6371L27.0651 12.6561C27.9264 12.9187 28.7709 13.2344 29.5984 13.6029L29.6579 13.6294L29.7135 13.663C30.4947 14.134 31.2452 14.6531 31.965 15.2201L32.0159 15.2601L32.0611 15.306C32.7081 15.9623 33.3122 16.6583 33.8734 17.3938L33.9123 17.4448L33.9443 17.5002C34.4101 18.3056 34.8231 19.1395 35.1834 20.0016L35.2079 20.0603L35.2247 20.1215C35.4724 21.0288 35.6607 21.951 35.7895 22.888L35.7981 22.9507L35.7985 23.0139C35.8046 23.9674 35.748 24.921 35.629 25.8744L35.6212 25.9371L35.6052 25.9984C35.3609 26.9376 35.0548 27.8615 34.6873 28.7698L34.6635 28.8286L34.6323 28.884C34.145 29.7475 33.601 30.5806 33.0006 31.3833L32.9624 31.4344L32.9178 31.4804C32.2113 32.2094 31.4568 32.8947 30.6549 33.5361L30.6046 33.5763L30.5496 33.61C29.6625 34.1529 28.7398 34.6411 27.7818 35.0744L27.7228 35.1011L27.6607 35.1204C26.6449 35.436 25.6084 35.689 24.5515 35.8796L24.4874 35.8911L24.4223 35.8948C23.3395 35.9554 22.2528 35.9496 21.1625 35.8773L21.0974 35.873L21.0333 35.8608C19.9516 35.6547 18.8836 35.3823 17.8295 35.0439L17.7675 35.024L17.7085 34.9967C16.698 34.529 15.7183 33.9996 14.7696 33.4088L14.7146 33.3746L14.6645 33.3339C13.7927 32.627 12.9674 31.8672 12.1887 31.0547L12.1442 31.0083L12.1061 30.9569C11.4335 30.0494 10.8205 29.1014 10.2671 28.1131L10.236 28.0575L10.2123 27.9986C9.78812 26.9432 9.43318 25.8628 9.14741 24.7576L9.13156 24.6963L9.12379 24.6336C8.98265 23.4943 8.91612 22.3474 8.92408 21.1932L8.92452 21.1301Z" fill="currentColor"></path></svg>',
    "8": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M9 19.35C9 18.6375 9.10243 17.9302 9.30322 17.25C9.37421 17.0087 9.45788 16.7708 9.5532 16.5373C9.9188 15.6455 10.4543 14.8353 11.1292 14.1528C11.804 13.4702 12.6057 12.9288 13.4875 12.5595C14.3693 12.1901 15.3144 12 16.2692 12C17.224 12 18.1692 12.1901 19.051 12.5595C19.9327 12.9288 20.7344 13.4702 21.4093 14.1528C22.0842 14.8353 22.6197 15.6455 22.9853 16.5373C23.0806 16.7708 23.1643 17.0087 23.2352 17.25C23.436 17.9302 23.5385 18.6375 23.5385 19.35V21.45V22.5V25.6479C23.5385 25.6493 23.5381 25.6506 23.5374 25.6518V25.6518C23.5368 25.653 23.5364 25.6544 23.5364 25.6557C23.5372 26.3435 23.6716 27.0244 23.9319 27.6598C24.1931 28.297 24.5754 28.8759 25.0581 29.3636C25.5403 29.8513 26.1128 30.2381 26.7431 30.5021C27.3734 30.766 28.0488 30.9018 28.7308 30.9018C29.4128 30.9018 30.0882 30.766 30.7185 30.5021C31.3487 30.2381 31.9212 29.8513 32.4034 29.3636C32.8861 28.8759 33.2685 28.297 33.5296 27.6598C33.7902 27.0232 33.9246 26.3409 33.9231 25.65V23.5C33.9231 22.9477 34.3708 22.5 34.9231 22.5H35C35.5523 22.5 36 22.9477 36 23.5V25.65C36 26.3625 35.8976 27.0698 35.6968 27.75C35.6258 27.9913 35.5421 28.2292 35.4468 28.4627C35.0812 29.3544 34.5457 30.1647 33.8709 30.8472C33.196 31.5297 32.3943 32.0711 31.5125 32.4405C30.6307 32.8099 29.6856 33 28.7308 33C27.776 33 26.8308 32.8099 25.949 32.4405C25.0673 32.0712 24.2656 31.5297 23.5907 30.8472C22.9158 30.1647 22.3803 29.3545 22.0147 28.4627C21.9585 28.3247 21.9062 28.1851 21.8581 28.0442C21.8246 27.9467 21.7937 27.8487 21.7648 27.75C21.564 27.0698 21.4615 26.3625 21.4615 25.65V22.5V21.45L21.4636 19.35C21.4636 18.6603 21.3292 17.9774 21.0681 17.3402C20.8069 16.703 20.4246 16.1241 19.9419 15.6364C19.4597 15.1487 18.8872 14.7619 18.2569 14.4979C17.6266 14.234 16.9512 14.0982 16.2692 14.0982C15.5872 14.0982 14.9118 14.234 14.2816 14.4979C13.6513 14.7619 13.0788 15.1487 12.5966 15.6364C12.1139 16.1241 11.7315 16.703 11.4704 17.3402C11.2093 17.9774 11.0749 18.6603 11.0749 19.35L11.0763 21.4994C11.0766 22.0519 10.6288 22.5 10.0763 22.5H10C9.44772 22.5 9 22.0523 9 21.5V19.35Z" fill="currentColor"></path></svg>',
    "9": '<svg  width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M18.4818 11.7993C19.7557 11.2716 21.1211 11 22.5 11C23.8789 11 25.2443 11.2716 26.5182 11.7993C27.7921 12.3269 28.9496 13.1004 29.9246 14.0754C30.8996 15.0504 31.6731 16.2079 32.2007 17.4818C32.6999 18.6869 32.9699 19.9739 32.9976 21.2767C32.9242 25.548 31.1565 28.9658 28.955 31.3349C27.8289 32.5467 26.5982 33.4736 25.4418 34.0931C24.271 34.7204 23.2381 35 22.5 35C21.7619 35 20.729 34.7204 19.5582 34.0931C18.4018 33.4736 17.1711 32.5467 16.045 31.3349C13.8435 28.9658 12.0758 25.548 12.0024 21.2767C12.0301 19.9739 12.3001 18.6869 12.7993 17.4818C13.3269 16.2079 14.1004 15.0504 15.0754 14.0754C16.0504 13.1004 17.2079 12.3269 18.4818 11.7993ZM10.0021 21.2733C10.0007 21.3488 10 21.4244 10 21.5H10.0069C10.138 26.242 12.123 30.0524 14.58 32.6964C15.8497 34.0627 17.2545 35.1279 18.6137 35.8561C19.9585 36.5765 21.3215 37 22.5 37C23.6785 37 25.0415 36.5765 26.3863 35.8561C27.7455 35.1279 29.1503 34.0627 30.42 32.6964C32.877 30.0524 34.862 26.242 34.9931 21.5H35C35 21.4244 34.9993 21.3488 34.9979 21.2733C34.9993 21.1825 35 21.0914 35 21H34.99C34.9311 19.5291 34.6128 18.0789 34.0485 16.7165C33.4203 15.1999 32.4996 13.8219 31.3388 12.6612C30.1781 11.5004 28.8001 10.5797 27.2835 9.95151C25.767 9.32332 24.1415 9 22.5 9C20.8585 9 19.233 9.32332 17.7165 9.95151C16.1999 10.5797 14.8219 11.5004 13.6612 12.6612C12.5004 13.8219 11.5797 15.1999 10.9515 16.7165C10.3872 18.0789 10.0689 19.5291 10.01 21H10C10 21.0914 10.0007 21.1825 10.0021 21.2733ZM20.6679 25.1074C21.9408 27.4965 22.0311 29.9388 20.8697 30.5626C19.7083 31.1864 17.7349 29.7554 16.462 27.3663C15.1891 24.9773 15.0988 22.5349 16.2602 21.9111C17.4216 21.2873 19.395 22.7184 20.6679 25.1074ZM29.6948 21.98C28.5541 21.3188 26.5355 22.6849 25.1863 25.0313C23.837 27.3777 23.6679 29.8159 24.8086 30.4771C25.9493 31.1383 27.9678 29.7722 29.3171 27.4258C30.6664 25.0794 30.8355 22.6412 29.6948 21.98Z" fill="currentColor"></path></svg>',
    "10": '<svg width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M23.5333 35.961C30.5064 35.4332 36 29.6082 36 22.5C36 15.0442 29.9558 9 22.5 9C15.0442 9 9 15.0442 9 22.5C9 29.6082 14.4936 35.4332 21.4667 35.961V27.5633C19.1084 27.0846 17.3333 24.9996 17.3333 22.5C17.3333 19.6465 19.6465 17.3333 22.5 17.3333C25.3535 17.3333 27.6667 19.6465 27.6667 22.5C27.6667 24.9996 25.8916 27.0846 23.5333 27.5633V35.961ZM22.5 38C31.0604 38 38 31.0604 38 22.5C38 13.9396 31.0604 7 22.5 7C13.9396 7 7 13.9396 7 22.5C7 31.0604 13.9396 38 22.5 38ZM22.5 25.6667C24.2489 25.6667 25.6667 24.2489 25.6667 22.5C25.6667 20.7511 24.2489 19.3333 22.5 19.3333C20.7511 19.3333 19.3333 20.7511 19.3333 22.5C19.3333 24.2489 20.7511 25.6667 22.5 25.6667Z" fill="currentColor"></path></svg>',
    "11": '<svg width="45" height="45" viewBox="0 0 45 45" fill="none"><circle  cx="22.5" cy="22.5" r="14.5" stroke="currentColor" stroke-width="2"></circle><path  fill-rule="evenodd" clip-rule="evenodd" d="M28.5 25.6C30.2121 25.6 31.6 24.2121 31.6 22.5C31.6 20.7879 30.2121 19.4 28.5 19.4C27.1502 19.4 26.002 20.2627 25.5764 21.4667H14C13.4477 21.4667 13 21.9144 13 22.4667V22.5334C13 23.0856 13.4477 23.5334 14 23.5334H25.5764C26.002 24.7374 27.1502 25.6 28.5 25.6Z" fill="currentColor"></path></svg>',
    "12": '<svg width="45" height="45" viewBox="0 0 45 45" fill="none"><path  fill-rule="evenodd" clip-rule="evenodd" d="M36 22.5C36 29.9558 29.9558 36 22.5 36C15.0442 36 9 29.9558 9 22.5C9 15.0442 15.0442 9 22.5 9C29.9558 9 36 15.0442 36 22.5ZM38 22.5C38 31.0604 31.0604 38 22.5 38C13.9396 38 7 31.0604 7 22.5C7 13.9396 13.9396 7 22.5 7C31.0604 7 38 13.9396 38 22.5ZM30.8333 22.5C30.8333 27.1024 27.1024 30.8333 22.5 30.8333C17.8976 30.8333 14.1667 27.1024 14.1667 22.5C14.1667 17.8976 17.8976 14.1667 22.5 14.1667C27.1024 14.1667 30.8333 17.8976 30.8333 22.5ZM32.8333 22.5C32.8333 28.2069 28.2069 32.8333 22.5 32.8333C16.7931 32.8333 12.1667 28.2069 12.1667 22.5C12.1667 16.7931 16.7931 12.1667 22.5 12.1667C28.2069 12.1667 32.8333 16.7931 32.8333 22.5Z" fill="currentColor"></path></svg>',
}

const App = {
    audio: {},
    state: {},
    ui: {},
    midi: {},
    sound: {},
    fx: {}
};
const sounds = [];
const packs = [];
let packCount = 17;
let packNum = 6;
let sampelsPerPack = 12;
const controls = [];
const MIDICC_count = 4;
const MIDInotes = { 45: 1, 46: 2, 47: 3, 42: 4, 43: 5, 44: 6, 39: 7, 40: 8, 41: 9, 36: 10, 37: 11, 38: 12 };
const MIDItcc = { 7: 1, 20: 2, 21: 3, 22: 4, };
const grid = Array.from({ length: sampelsPerPack }, () => Array(16).fill(false));
const trackLengths = Array(sampelsPerPack).fill(16);
const trackEnabled = Array(sampelsPerPack).fill(true);

let recordMode = false;
let tracksMode = false;
let trackLengthMode = false; // when true, clicking steps sets track length instead of toggling notes
let cutOffMode = false;
let noOverLap = true;
let metronomeEnabled = false;
let bpm = 50;

Howler.autoUnlock = true;
Howler.volume(1);

App.sound.sounds = sounds;
App.sound.packs = packs;
App.sound.packCount = packCount;
App.state.packNum = packNum;
App.state.sampelsPerPack = sampelsPerPack;
App.ui.controls = controls;
App.midi.MIDICC_count = MIDICC_count;
App.midi.MIDInotes = MIDInotes;
App.midi.MIDItcc = MIDItcc;
App.state.grid = grid;
App.state.trackLengths = trackLengths;
App.state.trackEnabled = trackEnabled;
App.state.recordMode = recordMode;
App.state.tracksMode = tracksMode;
App.state.trackLengthMode = trackLengthMode;
App.state.metronomeEnabled = metronomeEnabled;
App.state.bpm = bpm;


function loadPack(num, skipSave = false) {
    packNum = num;
    for (let index = 1; index <= sampelsPerPack; index++) {
        sounds[index] = new Howl({
            src: [`/sounds/${packNum}/${index}.mp3`],
            autoplay: false,
            loop: false,
            volume: 1,
        });
    }
    if (!skipSave) saveState();

}

function playSound(number) {
    sounds[number].play();
};

const packSelect = document.getElementById("packSelector");
for (let i = 1; i <= packCount; i++) {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `${i}`;
    packSelect.appendChild(opt);
}
packSelect.value = packNum;
packSelect.onchange = function () { loadPack(Number(packSelect.value), true); };
const noInputElemnt = document.getElementById("noInput");
function onMidiEnabled() {
    const aceptedMIDI = WebMidi.getInputByName("HOLOMATE.MIDI");
    if (aceptedMIDI) {
        noInputElemnt.classList.toggle("hidden")
        WebMidi.inputs[0].addListener("noteon", e => {
            const rowIndex = MIDInotes[e.note.number] - 1;
            if (tracksMode) {
                trackEnabled[rowIndex] = !trackEnabled[rowIndex];
                const btn = App.ui.soundButtons[rowIndex];
                if (btn) btn.style.opacity = trackEnabled[rowIndex] ? '1' : '0.4';
                return;
            }
            if (noOverLap) sounds[MIDInotes[e.note.number]].stop(); //cutoff
            playSound(MIDInotes[e.note.number]);

            // Recording: quantize incoming MIDI to nearest step
            if (recordMode) {
                const row = MIDInotes[e.note.number] - 1; // zero-based row
                const col = Math.floor((audioCtx.currentTime - startTime) / secPerStep) % 16;
                console.log(col, grid[row][col]);
                // bounds safety
                if (row >= 0 && row < grid.length && col >= 0 && col < grid[0].length) {
                    grid[row][col] = !grid[row][col];
                    // update button UI
                    const idx = row * 16 + col;
                    App.ui.gridButtons[idx].classList.toggle('active', grid[row][col]);
                    saveState();
                }
            }
            selectTrack(rowIndex + 1)
        });
        WebMidi.inputs[0].addListener("controlchange", e => {
            console.log(e);
        }, { channels: [1, 2, 3] });
    }
}
WebMidi.enable().then(onMidiEnabled);

// --- TUNA FX SETUP ---
const audioCtx = Howler.ctx;
const tuna = new Tuna(audioCtx);

App.fx.gain = new tuna.Gain({
    gain: 1 // 0 and up
});
App.fx.compressor = new tuna.Compressor({
    threshold: -20,    //-100 to 0
    makeupGain: 1,     //0 and up (in decibels)
    attack: 1,         //0 to 1000
    release: 250,      //0 to 3000
    ratio: 4,          //1 to 20
    knee: 5,           //0 to 40
    automakeup: false, //true/false
});
App.fx.overdrive = new tuna.Overdrive({
    outputGain: 0.7,              //-42 to 0 in dB
    drive: 0.6,                   //0 to 1
    curveAmount: 0.979,           //0 to 1
    algorithmIndex: 0,            //0 to 5, selects one of the drive algorithms
});
App.fx.wahwah = new tuna.WahWah({
    automode: true,                  //true/false
    baseFrequency: 0.153,            //0 to 1
    excursionOctaves: 3.3,           //1 to 6
    sweep: 0.35,                     //0 to 1
    resonance: 19,                   //1 to 100
    sensitivity: -0.5,               //-1 to 1
});
App.fx.moog = new tuna.MoogFilter({
    cutoff: 0.065,    //0 to 1
    resonance: 3.5,   //0 to 4
    bufferSize: 4096  //256 to 16384
});
App.fx.filter = new tuna.Filter({
    frequency: 1200,         //20 to 22050
    Q: 1,                   //0.001 to 100
    gain: 0,                //-40 to 40 (in decibels)
    filterType: "lowpass",  //lowpass, highpass, bandpass, lowshelf, highshelf, peaking, notch, allpass
});
App.fx.bitcrusher = new tuna.Bitcrusher({
    bits: 4,          //1 to 16
    normfreq: 0.1,    //0 to 1
    bufferSize: 4096  //256 to 16384
});
App.fx.phaser = new tuna.Phaser({
    rate: 0.1,                     //0.01 to 8 is a decent range, but higher values are possible
    depth: 0.6,                    //0 to 1
    feedback: 0.7,                 //0 to 1+
    stereoPhase: 40,               //0 to 180
    baseModulationFrequency: 700,  //500 to 1500
});
App.fx.chorus = new tuna.Chorus({
    rate: 1.5,         //0.01 to 8+
    feedback: 0.4,     //0 to 1+
    depth: 0.7,        //0 to 1
    delay: 0.0045,     //0 to 1
});
App.fx.tremolo = new tuna.Tremolo({
    intensity: 0.3,    //0 to 1
    rate: 5,           //0.001 to 8
    stereoPhase: 0,    //0 to 180
});
App.fx.echo = new tuna.Delay({
    feedback: 0.45,    //0 to 1+
    delayTime: 150,    //1 to 10000 milliseconds
    wetLevel: 0.5,     //0 to 1+
    dryLevel: 1,       //0 to 1+
    // cutoff: 20000,      //cutoff frequency of the built in lowpass-filter. 20 to 22050
});
App.fx.pingPongDelay = new tuna.PingPongDelay({
    wetLevel: 0.5,       //0 to 1
    feedback: 0.3,       //0 to 1
    delayTimeLeft: 200,  //1 to 10000 (milliseconds)
    delayTimeRight: 400  //1 to 10000 (milliseconds)
});
App.fx.reverb = new tuna.Convolver({
    highCut: 22050,                         //20 to 22050
    lowCut: 20,                             //20 to 22050
    dryLevel: 1,                            //0 to 1+
    wetLevel: .5,                            //0 to 1+
    level: 1,                               //0 to 1+, adjusts total output of both wet and dry
    impulse: '/impulses/large-ambience.mp3', //the path to your impulse response
    onError: function (err) { try { App.fx.reverb.buffer = audioCtx.createBuffer(2, 1, audioCtx.sampleRate); } catch (e) { console.error('Fallback buffer creation failed', e); } }
});
App.fx.cabinet = new tuna.Cabinet({
    makeupGain: 1,                                 //0 to 20
    impulsePath: "/impulses/impulse_guitar.wav",    //path to your speaker impulse
});
App.fx.panner = new tuna.Panner({
    pan: 0 // -1 (left) to 1 (right)
});

for (const fx in App.fx) { fx.bypass = true; }



const analyzer = audioCtx.createAnalyser();
analyzer.fftSize = 1024;
const timeData = new Uint8Array(analyzer.frequencyBinCount);

let activeFX = [];
let FXchainSpan = document.getElementById("FXchainSpan");

function rebuildFXChain() {
    Howler.masterGain.disconnect();
    activeFX.forEach(fx => fx.disconnect());
    let prev = Howler.masterGain;
    for (const fx of activeFX) { prev.connect(fx.input || fx); prev = fx; }
    prev.connect(analyzer.input || analyzer);
    if (!analyzer.connectedToDest) {
        analyzer.connect(audioCtx.destination);
        analyzer.connect(MediaStreamDestination);
        analyzer.connectedToDest = true;
    }
    FXchainSpan.innerHTML = activeFX.length > 0 ? activeFX.map(f => " → " + f.name).join("") : "audio → output"
}


function toggleFX(fxName, fxNode, enable) {
    fxNode.bypass = !enable;

    if (enable) {
        if (!activeFX.includes(fxNode)) activeFX.push(fxNode);
        document.getElementById(fxName + "_params").style.display = "flex";
    } else {
        activeFX = activeFX.filter(fx => fx !== fxNode);
        document.getElementById(fxName + "_params").style.display = "none";
    }

    rebuildFXChain();
    console.log(`FX: ${fxName} ${enable ? "ON" : "OFF"}`);
}


let fxControls = document.getElementById("fxControls");
function buildFxParams(effectName, params) {
    const fx = App.fx[effectName]; if (!fx) return;
    const FxHead = document.createElement('div');
    let paramsContainer = document.createElement("div");
    let FXContainer = document.createElement("div");
    FxHead.classList.add('FxHead');
    const checked = !fx.bypass ? "checked" : "";
    FxHead.insertAdjacentHTML(
        'beforeend',
        `
        <label for="${effectName + "_checkbox"}">${effectName}</label>
        <input type="checkbox" class="fx-toggler" id="${effectName + "_checkbox"}"/>
        `
    );

    FxHead.querySelector('.fx-toggler').addEventListener('change', e => {
        toggleFX(effectName, fx, e.target.checked);
    });

    let paramValue;
    let isMultipleParams = params.length < 2;
    params.forEach(param => {
        paramValue = typeof fx[param.name] === 'object' ? Math.round(fx[param.name].value) : Math.round(fx[param.name]);
        const html = `
            <div class="FxParam">
            <div class="FxParamHead">
                ${!isMultipleParams ? `<span>${param.name}</span>` : `<span></span>`}
                <span id="${effectName}_${param.name}_val">${paramValue}</span>
            </div>
                <input id="${effectName}_${param.name}" 
                    type="range" 
                    step="${param.step}" 
                    min="${param.min}" 
                    max="${param.max}" 
                    value="${paramValue}" />
            </div>`;

        paramsContainer.insertAdjacentHTML('beforeend', html);
        paramsContainer.classList.add("FxParams")
        paramsContainer.id = `${effectName + "_params"}`
        const input = paramsContainer.querySelector(`#${effectName}_${param.name}`);
        const valueSpan = paramsContainer.querySelector(`#${effectName}_${param.name}_val`);
        input.addEventListener('input', e => {
            const val = parseFloat(e.target.value);
            fx[param.name] = val;
            valueSpan.textContent = val;
        });
    });

    FXContainer.appendChild(FxHead);
    FXContainer.appendChild(paramsContainer);
    fxControls.appendChild(FXContainer);
}

buildFxParams("gain", [{ name: "gain", min: 0, max: 3, step: 0.1 },]);
buildFxParams("compressor", [
    { name: "threshold", min: -100, max: 0, step: 1, },
    { name: "makeupGain", min: 0, max: 10, step: 0.1, },
    { name: "attack", min: 0, max: 1000, step: 10, },
    { name: "release", min: 0, max: 3000, step: 30, },
    { name: "ratio", min: 1, max: 20, step: 1, },
    { name: "knee", min: 0, max: 40, step: 1, },
    { name: "automakeup", min: -100, max: 0, step: 1, },
]);
buildFxParams("overdrive", [
    { name: "outputGain", min: -42, max: 0, step: 1, },
    { name: "drive", min: 0, max: 1, step: 0.1, },
    { name: "curveAmount", min: 0, max: 1, step: 0.1, },
    { name: "algorithmIndex", min: 0, max: 5, step: 1, },
]);
buildFxParams("wahwah", [
    // { name: "automodexx", min: -42, max: 0, step: 1, },
    { name: "baseFrequency", min: 0, max: 1, step: 0.01, },
    { name: "excursionOctaves", min: 1, max: 6, step: 0.1, },
    { name: "sweep", min: 0, max: 1, step: 0.1, },
    { name: "resonance", min: 1, max: 100, step: 1, },
    { name: "sensitivity", min: -1, max: 1, step: 1, },
]);
buildFxParams("moog", [
    { name: "cutoff", min: 0, max: 1, step: 0.1 },
    { name: "resonance", min: 0, max: 4, step: 0.1 },
    { name: "bufferSize", min: 256, max: 16384, step: 1 },
]);
buildFxParams("filter", [
    { name: "frequency", min: 20, max: 22050, step: 100, },
    { name: "Q", min: 0.001, max: 100, step: 0.01, },
    { name: "gain", min: -40, max: 40, step: 0.1, },
    { name: "filterType", min: 0, max: 1, step: 0.1, },
]);
buildFxParams("bitcrusher", [
    { name: "bits", min: 1, max: 16, step: 1 },
    { name: "normfreq", min: 0.1, max: 1, step: 0.1 },
    { name: "bufferSize", min: 256, max: 16384, step: 100 },
]);
buildFxParams("phaser", [
    { name: "rate", min: 0.01, max: 8, step: 0.1 },
    { name: "depth", min: 0, max: 1, step: 0.1 },
    { name: "feedback", min: 0, max: 1, step: 0.1 },
    { name: "stereoPhase", min: 0, max: 180, step: 1 },
    { name: "baseModulationFrequency", min: 500, max: 1500, step: 100 },
]);
buildFxParams("chorus", [
    { name: "rate", min: 0.01, max: 8, step: 0.1 },
    { name: "feedback", min: 0, max: 1, step: 0.1 },
    { name: "depth", min: 0, max: 1, step: 0.1 },
    { name: "delay", min: 0, max: 1, step: 0.1 },
]);
buildFxParams("tremolo", [
    { name: "intensity", min: 0, max: 1, step: 0.1 },
    { name: "rate", min: 0.001, max: 8, step: 0.01 },
    { name: "stereoPhase", min: 0, max: 180, step: 1 },
]);
buildFxParams("echo", [
    { name: "feedback", min: 0, max: 1, step: 0.1 },
    { name: "delayTime", min: 1, max: 10000, step: 100 },
    { name: "wetLevel", min: 0, max: 1, step: 0.1 },
    { name: "dryLevel", min: 0, max: 1, step: 0.1 },
]);
buildFxParams("pingPongDelay", [
    { name: "wetLevel", min: 0, max: 1, step: 0.1 },
    { name: "feedback", min: 0, max: 1, step: 0.1 },
    { name: "delayTimeLeft", min: 1, max: 10000, step: 100 },
    { name: "delayTimeRight", min: 1, max: 10000, step: 100 },
]);
buildFxParams("reverb", [
    { name: "highCut", min: 20, max: 22050, step: 100 },
    { name: "lowCut", min: 20, max: 22050, step: 100 },
    { name: "dryLevel", min: 0, max: 1, step: 0.1 },
    { name: "wetLevel", min: 0, max: 1, step: 0.1 },
    { name: "level", min: 0, max: 1, step: 0.1 },
]);
buildFxParams("cabinet", [
    { name: "makeupGain", min: 0, max: 20, step: 1 },
]);
buildFxParams("panner", [{ name: "pan", min: -1, max: 1, step: 0.1 }]);


// mediaRecorder setup
const MediaStreamDestination = audioCtx.createMediaStreamDestination();
analyzer.connect(MediaStreamDestination); analyzer.connect(audioCtx.destination);
const mediaRecorder = new MediaRecorder(MediaStreamDestination.stream);
let chunks = [];
mediaRecorder.ondataavailable = e => { chunks.push(e.data); }
mediaRecorder.onstop = () => {
    const blob = new Blob(chunks, { type: 'audio/webm' });
    const url = URL.createObjectURL(blob);
    document.querySelector('audio').src = url;
};
// mediaRecorder.onstop = () => {
//     const blob = new Blob(chunks, { type: 'audio/webm' });
//     const url = URL.createObjectURL(blob);
//     const a = document.createElement('a');
//     a.href = url;
//     const now = new Date();
//     const timestamp = now.toISOString().replace(/[:.]/g, '-');
//     a.download = `webmidi_output_${timestamp}.webm`;
//     a.click();
// };
rebuildFXChain();
// Visualizer draw loop
const canvas = document.createElement("canvas");
canvas.id = "visualizerCanvas";
const visualiserContainer = document.getElementById("visualiser")
visualiserContainer.appendChild(canvas)
const ctx = canvas.getContext("2d");
function drawVisualizer() {
    analyzer.getByteTimeDomainData(timeData);
    const width = 600;
    const height = 300;
    if (canvas.width !== width || canvas.height !== height) {
        canvas.width = width;
        canvas.height = height;
    }
    ctx.clearRect(0, 0, width, height);
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#8D9BAA";
    ctx.beginPath();

    const sliceWidth = width / timeData.length;
    let x = 0;

    // Smooth curve drawing
    for (let i = 0; i < timeData.length; i++) {
        const v = timeData[i] / 128;
        const y = v * (height / 2);

        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);

        x += sliceWidth;
    }

    ctx.stroke();

    requestAnimationFrame(drawVisualizer);
}
drawVisualizer();


const fxOffButton = document.createElement('button');
fxOffButton.textContent = "fx off";
fxOffButton.addEventListener('click', () => { toggle("fx off"); });
document.getElementById("fxboard").appendChild(fxOffButton);
// //
// persistence defaults
let defaultState = {
    grid: Array.from({ length: 12 }, () => Array(16).fill(false)),
    trackEnabled: Array(12).fill(true),
    trackLengths: Array(12).fill(16),
    bpm: 50,
    packNum: packNum,
    recordMode: false,
    tracksMode: false,
    fx: { overdrive: true, filter: true, echo: true, reverb: true },
    metronomeEnabled: false
};
// //
// --- Build the sequencer grid ---
// Create 4x3 grid of sound buttons
const soundsGrid = document.getElementById("sampels");

// Create 4x3 grid of volume sliders
const volumesGrid = document.getElementById("sampleVolumes");
let gridContainer = document.getElementById("sequencer");
for (let row = 0; row < sampelsPerPack; row++) {
    // --- Sound Buttons ---
    const soundBtn = document.createElement("button");
    soundBtn.classList.add("sound");
    soundBtn.innerHTML = svgElemnts[row + 1];
    soundBtn.addEventListener("click", () => handleSoundClick(row + 1));
    soundsGrid.appendChild(soundBtn);

    // --- Volume Slider for volumesGrid ---
    const volSlider = document.createElement("input");
    const volSliderContainer = document.createElement("div");
    volSlider.type = "range";
    volSlider.classList.add("sampleVolume");
    // volSlider.classList.add("input-knob");
    volSlider.dataset.sample = row + 1;
    volSlider.min = "0";
    volSlider.max = "100";
    volSlider.step = "1";
    volSlider.value = "100";
    // if (row > 0) volSlider.classList.add("hidden");
    if (row > 0) volSliderContainer.classList.add("hidden");
    volSliderContainer.classList.add("sampleVolumeContainer");
    volSliderContainer.appendChild(volSlider)
    volumesGrid.appendChild(volSliderContainer);

    // --- Step Sequencer Grid Row ---
    const gridRow = document.createElement('div');
    gridRow.classList.add("gridRow");
    if (row > 0) gridRow.classList.add("hidden");
    for (let col = 0; col < 16; col++) {
        const btn = document.createElement('button');
        btn.dataset.row = row;
        btn.dataset.col = col;
        btn.addEventListener('click', () => {
            if (trackLengthMode) {
                // set track length for this row to this column (col is zero-based)
                const newLen = col + 1;
                trackLengths[row] = newLen;
                // dim steps beyond new length and clear any notes beyond length
                for (let c = 0; c < 16; c++) {
                    const idx2 = row * 16 + c;
                    if (App.ui.gridButtons[idx2]) {
                        App.ui.gridButtons[idx2].style.opacity = (c < newLen) ? '1' : '0.3';
                        if (c >= newLen) {
                            if (grid[row][c]) {
                                grid[row][c] = false;
                                App.ui.gridButtons[idx2].classList.remove('active');
                            }
                        }
                    }
                }
                console.log('set row', row, 'length ->', newLen);
                saveState();
                return;
            }
            // normal behavior: toggle note
            grid[row][col] = !grid[row][col];
            btn.classList.toggle('active', grid[row][col]);
            saveState();
        });
        // apply initial opacity based on track length
        btn.style.opacity = (col < trackLengths[row]) ? '1' : '0.5';
        gridRow.appendChild(btn);
    }
    gridContainer.appendChild(gridRow);
}
gridContainer.classList.add("grid");

// Add the sound and volume grids, then the sequencer grid


App.ui.gridButtons = Array.from(document.querySelectorAll('.grid button'));
App.ui.soundButtons = Array.from(document.querySelectorAll('.sound'));
App.ui.volumeSliders = Array.from(document.querySelectorAll('.sampleVolume'));

App.ui.soundButtons.forEach(btn => btn.style.opacity = '1');
const gridRows = document.querySelectorAll(".gridRow");

function selectTrack(index) {
    const rowIndex = index - 1;
    gridRows.forEach((r, i) => r.classList.toggle("hidden", i !== rowIndex));
    document.querySelectorAll(".sampleVolumeContainer").forEach((s, i) => s.classList.toggle("hidden", i !== rowIndex));
    App.ui.soundButtons.forEach((soundButton, i) => soundButton.classList.remove("selectedSound", i !== rowIndex));
    App.ui.soundButtons[index - 1].classList.toggle("selectedSound");
}

function handleSoundClick(index) {
    const rowIndex = index - 1;

    // Track toggle mode
    if (tracksMode) {
        trackEnabled[rowIndex] = !trackEnabled[rowIndex];
        const btn = App.ui.soundButtons[rowIndex];
        btn.style.opacity = trackEnabled[rowIndex] ? '1' : '0.4';
        console.log('sample ', rowIndex, trackEnabled[rowIndex]);
        saveState();
        return;
    }
    selectTrack(rowIndex + 1)
    playSound(index);
}

function toggle(param) {
    if (param === 'play') {
        if (isSequencerON) { stopSequencer(); } else { startSequencer(); };
        document.getElementById("play_toggler").style.backgroundColor = `${isSequencerON ? "rgba(90, 90, 90, 1)" : "rgb(50, 50, 50)"}`
        saveState();
        return;
    }
    if (param === 'rec') {
        recordMode = !recordMode;
        document.getElementById("rec_toggler").style.backgroundColor = `${recordMode ? "rgba(90, 90, 90, 1)" : "rgb(50, 50, 50)"}`
        saveState();
        return;
    }
    if (param === 'tracks') {
        tracksMode = !tracksMode;
        document.getElementById("tracks_toggler").style.backgroundColor = `${tracksMode ? "rgba(90, 90, 90, 1)" : "rgb(50, 50, 50)"}`
        saveState();
        return;
    }
    if (param === 'tracks on') {
        for (let i = 0; i < trackEnabled.length; i++) {
            trackEnabled[i] = true;
            App.ui.soundButtons[i].style.opacity = '1';
        }
        saveState();
        return;
    }
    if (param === 'cutoff') {
        cutOffMode = !cutOffMode;
        document.getElementById("cutoff_toggler").style.backgroundColor = `${cutOffMode ? "rgba(90, 90, 90, 1)" : "rgb(50, 50, 50)"}`
        saveState();
        return;
    }
    if (param === 'track length') {
        trackLengthMode = !trackLengthMode;
        document.getElementById("tracklength_toggler").style.backgroundColor = `${trackLengthMode ? "rgba(90, 90, 90, 1)" : "rgb(50, 50, 50)"}`
        saveState();
        return;
    }
    if (param === 'metronome') {
        metronomeEnabled = !metronomeEnabled;
        document.getElementById("metronome_toggler").style.backgroundColor = `${metronomeEnabled ? "rgba(90, 90, 90, 1)" : "rgb(50, 50, 50)"}`
        saveState(); return;
    }
    if (param === 'clear') { resetState(); return; }
    if (param === 'fx off') {
        for (const fx in App.fx) { fx.bypass = true; }
        document.querySelectorAll(".fx-toggler").forEach(sw => { sw.checked = false; });
        FXchainSpan.innerText = "";
        activeFX = [];
        saveState();
        return;
    }
}

App.ui.volumeSliders.forEach(slider => {
    slider.addEventListener("input", () => {
        const i = Number(slider.dataset.sample); // 1–12
        const v = slider.value / 100;
        sounds[i].volume(v);
        saveState();
    });
});

const numberKeyslist = [49, 50, 51, 52, 53, 54, 55, 56, 57, 48, 189, 187];

document.addEventListener("keydown", e => {
    const code = e.keyCode;
    if (!numberKeyslist.includes(code)) return;

    const index = numberKeyslist.indexOf(code) + 1;

    if (cutOffMode) sounds[index].stop();


    if (recordMode) {
        const row = index - 1;
        const col = isSequencerON ? (Math.floor((audioCtx.currentTime - startTime) / secPerStep) % 16) : 0; // current step when running, step 0 when stopped
        // bounds safety
        if (row >= 0 && row < grid.length && col >= 0 && col < grid[0].length) {
            grid[row][col] = !grid[row][col];
            // update button UI
            const idx = row * 16 + col;
            App.ui.gridButtons[idx].classList.toggle('active', grid[row][col]);
            saveState();
        }
    }


    selectTrack(index)
    playSound(index);
});

// --- simple sequencer (WebAudio based)---
let isSequencerON = false;
let startTime = 0; // audioCtx time when sequencer started
let nextNoteTime = 0; // when the next step is scheduled (in audioCtx time)
let currentStep = 0; // renderer visible step
const scheduleAheadTime = 0.2; // seconds to schedule ahead (200 ms)
// secPerStep will be recalculated when starting so not const
let secPerStep = (60 / bpm) / 4; // seconds per 16th (updated on start)

const metClick = new Howl({ src: ['/sounds/clicks/click.mp3'], volume: 1 });
const metClickUp = new Howl({ src: ['/sounds/clicks/clickup.mp3'], volume: 1 });

// schedule notes up to (audioCtx.currentTime + scheduleAheadTime)
function schedule() {
    const lookahead = audioCtx.currentTime + scheduleAheadTime;
    while (nextNoteTime < lookahead) {

        const stepIndex = Math.floor((nextNoteTime - startTime) / secPerStep);
        const quarter = stepIndex % 4;

        for (let r = 0; r < 12; r++) {
            if (!trackEnabled[r]) continue;

            const len = trackLengths[r];
            const col = stepIndex % len;
            if (col < 0) continue;

            if (grid[r][col]) {
                const sampleIndex = r + 1;
                const delayMs = Math.max(0, (nextNoteTime - audioCtx.currentTime) * 1000);
                setTimeout(() => {
                    playSound(sampleIndex);
                    const btn = App.ui.soundButtons[sampleIndex - 1];
                    if (btn) {
                        btn.style.opacity = '0.5';
                        setTimeout(() => { btn.style.opacity = '1'; }, 120);
                    }
                }, delayMs);
            }
        }

        if (metronomeEnabled && recordMode && quarter === 0) {
            const md = Math.max(0, (nextNoteTime - audioCtx.currentTime) * 1000);
            setTimeout(() => metClick.play(), md);
        }

        nextNoteTime += secPerStep;
    }
}

function schedulerLoop() {
    if (!isSequencerON) return;
    schedule();
    requestAnimationFrame(schedulerLoop);
}

App.renderPlayhead = function () {
    if (!isSequencerON) return;

    const elapsed = audioCtx.currentTime - startTime;
    // clear playheads first
    App.ui.gridButtons.forEach(btn => { btn.classList.remove('playhead'); });

    for (let r = 0; r < 12; r++) {
        const len = trackLengths[r];
        if (len <= 0) continue;

        const stepFloat = elapsed / secPerStep;
        const col = Math.floor(stepFloat % len);

        const idx = r * 16 + col;
        if (App.ui.gridButtons[idx]) App.ui.gridButtons[idx].classList.add('playhead');
    }

    requestAnimationFrame(App.renderPlayhead);
};

function startSequencer() {
    if (isSequencerON) return;
    secPerStep = (60 / bpm) / 4;
    startTime = audioCtx.currentTime + 0.05;
    nextNoteTime = startTime;
    isSequencerON = true;
    mediaRecorder.start();
    schedulerLoop();
    App.renderPlayhead();
}

function stopSequencer() {
    if (!isSequencerON) return;
    isSequencerON = false;
    setTimeout(() => { mediaRecorder.stop(); }, 5000) // 5sec room to record the sustain
    App.ui.gridButtons.forEach(btn => btn.classList.remove('playhead'));
}

function applyBPM(newVal) {
    if (newVal < 40) newVal = 40;
    if (newVal > 240) newVal = 240;

    const oldSecPerStep = secPerStep;

    const now = audioCtx.currentTime;
    const elapsed = now - startTime;
    const stepFloat = elapsed / oldSecPerStep;

    bpm = newVal;
    document.getElementById('bpmDisplay').value = bpm;

    // recalc seconds per step for new BPM
    secPerStep = (60 / bpm) / 4;
    if (isSequencerON) {
        const now = audioCtx.currentTime;
        const elapsed = now - startTime;
        const stepFloat = elapsed / oldSecPerStep;

        const fractional = stepFloat - Math.floor(stepFloat);

        // re-anchor startTime to preserve visual position
        startTime = now - fractional * secPerStep;

        nextNoteTime = now + (1 - fractional) * secPerStep;
        currentStep = Math.floor((audioCtx.currentTime - startTime) / secPerStep) % 16;
    }

    saveState();
}
const bpmInput = document.getElementById('bpmDisplay');
const tapBtn = document.getElementById('tapTempo');

if (tapBtn) tapBtn.addEventListener('click', registerTap);
if (bpmInput) bpmInput.addEventListener('change', () => applyBPM(parseInt(bpmInput.value) || bpm));

let tapTimes = [];
function registerTap() {
    const t = performance.now();
    tapTimes = tapTimes.filter(x => t - x < 2000);
    tapTimes.push(t);
    if (tapTimes.length > 1) {
        let avg = 0;
        for (let i = 1; i < tapTimes.length; i++) avg += tapTimes[i] - tapTimes[i - 1];
        avg /= (tapTimes.length - 1);
        applyBPM(Math.round(60000 / avg));
    }
}

const modeToggles = ["tracks", "tracks on", "cutoff", "track length",];
const mainToggles = ["play", "rec", "metronome", "clear"];

const modeTogglesContainer = document.getElementById("modes");
const mainTogglesContainer = document.getElementById("mainToggles");

modeToggles.forEach(name => {
    const btn = document.createElement('button');
    btn.textContent = name;
    btn.id = name.replace(/\s+/g, "") + "_toggler";
    btn.addEventListener('click', () => { toggle(name); });
    modeTogglesContainer.appendChild(btn);
});
mainToggles.forEach(name => {
    const btn = document.createElement('button');
    btn.textContent = name;
    btn.id = name.replace(/\s+/g, "") + "_toggler";
    btn.addEventListener('click', () => { toggle(name); });
    mainTogglesContainer.appendChild(btn);
});



// state
function saveState() {
    const volumes = [];
    App.ui.volumeSliders.forEach(sl => {
        volumes.push(Number(sl.value)); // store 0–100
    });

    try {
        const state = {
            grid,
            trackEnabled,
            trackLengths,
            bpm,
            packNum,
            recordMode,
            tracksMode,
            fx: {
                overdrive: App.fx.overdrive ? App.fx.overdrive.bypass : true,
                filter: App.fx.filter ? App.fx.filter.bypass : true,
                echo: App.fx.echo ? App.fx.echo.bypass : true,
                reverb: App.fx.reverb ? App.fx.reverb.bypass : true,
            },
            volumes,
            metronomeEnabled,
        };

        localStorage.setItem('midi.state', JSON.stringify(state));
    } catch (e) {
        console.warn('saveState failed', e);
    }
}

function loadState() {
    try {
        const json = localStorage.getItem('midi.state');
        if (!json) return;
        const state = JSON.parse(json);
        if (!state || !state.grid) return;


        if (Array.isArray(state.volumes)) {
            App.ui.volumeSliders.forEach((sl, i) => {
                if (typeof state.volumes[i] !== 'undefined') {
                    const v = Number(state.volumes[i]);
                    sl.value = v;
                    if (sounds[i + 1]) sounds[i + 1].volume(v / 100);
                }
            });
        }

        // restore grid
        state.grid.forEach((r, i) => {
            r.forEach((v, c) => { if (grid[i] && typeof grid[i][c] !== 'undefined') grid[i][c] = !!v; });
        });
        // restore track enabled
        if (Array.isArray(state.trackEnabled)) {
            state.trackEnabled.forEach((v, i) => { if (typeof trackEnabled[i] !== 'undefined') trackEnabled[i] = !!v; });
        }
        // restore track lengths
        if (Array.isArray(state.trackLengths)) {
            state.trackLengths.forEach((v, i) => { if (typeof trackLengths[i] !== 'undefined') trackLengths[i] = Number(v) || 16; });
        }
        bpm = state.bpm || bpm;
        packNum = state.packNum || packNum;
        recordMode = !!state.recordMode;
        tracksMode = !!state.tracksMode;
        if (state.fx) {
            if (App.fx.overdrive) App.fx.overdrive.bypass = !!state.fx.overdrive;
            if (App.fx.filter) App.fx.filter.bypass = !!state.fx.filter;
            if (App.fx.echo) App.fx.echo.bypass = !!state.fx.echo;
            if (App.fx.reverb) App.fx.reverb.bypass = !!state.fx.reverb;
        }
        metronomeEnabled = !!state.metronomeEnabled;

        // update UI to match restored state
        // grid cells
        for (let row = 0; row < sampelsPerPack; row++) {
            for (let col = 0; col < 16; col++) {
                const idx = row * 16 + col;
                if (App.ui.gridButtons[idx]) {
                    App.ui.gridButtons[idx].classList.toggle('active', !!grid[row][col]);
                    App.ui.gridButtons[idx].style.opacity = (col < trackLengths[row]) ? '1' : '0.3';
                }
            }
        }
        // track buttons opacity
        App.ui.soundButtons.forEach((btn, i) => { btn.style.opacity = trackEnabled[i] ? '1' : '0.4'; });
        document.getElementById('bpmDisplay').value = bpm;

    } catch (e) {
        console.warn('loadState failed', e);
    }
}

function resetState() {
    localStorage.removeItem('midi.state');
    // reset in-memory values to defaults
    for (let r = 0; r < 12; r++) for (let c = 0; c < 16; c++) grid[r][c] = false;
    for (let i = 0; i < trackEnabled.length; i++) trackEnabled[i] = true;
    for (let i = 0; i < trackLengths.length; i++) trackLengths[i] = 16;
    bpm = defaultState.bpm;
    packNum = defaultState.packNum;
    recordMode = false;
    tracksMode = false;
    App.fx.overdrive.bypass = true; App.fx.filter.bypass = true; App.fx.echo.bypass = true; App.fx.reverb.bypass = true;
    metronomeEnabled = false;
    // visually update
    App.ui.gridButtons.forEach(btn => btn.classList.remove('active'));
    App.ui.soundButtons.forEach(btn => btn.style.opacity = '1');
}
window.addEventListener('DOMContentLoaded', () => { loadState(); loadPack(packNum, true); });